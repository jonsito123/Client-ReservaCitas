<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Registro Doctor</title>
    <style>
        *{
          margin: 0;
          padding: 0;
          box-sizing: border-box;
        }

        body {
            font-family: 'Franklin Gothic Medium', 'Arial Narrow', Arial, sans-serif;
            background-color: #f4f4f4;
            padding: 10px;
        }
        .container {

           max-width: 600px;
           
           margin: 0 auto;
           background-color:white;
           padding: 15px;
           border-radius:10px;
           box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
         h2 {
            text-align: center;
            text-transform: uppercase;
            color: #333;
            margin-bottom: 20px;
         }
         .form-group {
            margin-bottom:18px ;
         }
         label{ 
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
         }
         select,input[type="date"],input[type="time"],input[type="number"] {

            width: 100%;
            padding: 5px;
            border: 1px solid rgb(220, 220, 220);
            border-radius: 4px;
            font-size: 13px;
         }
         select:focus,input:focus {

             outline: none;
             border-color: rgb(224, 255, 255);
         }
          .time-group {
            display: flex;
            justify-content: flex-start;
            gap:10px;
        }
        .time-group .form-group {
            flex: 1;
        }

        .btn-submit{
            width: 100%;
            padding: 8px;
            background-color: #4CAF50;
            color: white;
            border: none;
            border-radius: 2px;
            font-size: 15px;
            cursor: pointer;
            margin-top: 10px;
            
        }
        .btn-submit:hover {
           
            background-color: #45a049;
        }
    </style>
</head>
<body>

    <div class="container">
        <h2>Registro de Horario Médico</h2>
        <form id="horarioForm">
            <div class="form-group">
                <label for="especialidad">Especialidad:</label>
                <select id="especialidad" name="especialidad" required onchange="seleccionarMedico(event)">
                    
                </select>
            </div>

            <div class="form-group">
                <label for="cbMedicos">Doctor:</label>
                <select id="cbMedicos" name="cbMedicos" required>
                </select>
            </div>

            <div class="form-group">
                <label for="fechaAtencion">Fecha de Atención:</label>
                <input type="date" id="fechaAtencion" name="fechaAtencion" required>
            </div>
            <div class="form-group">
                <label for="Cupos">Cupos :</label>
                <input type="number" id="Cupos" name="Cupos" required min="0">
            </div>

            <div class="time-group">
                <div class="form-group">
                    <label for="horaInicio">Hora Inicio:</label>
                    <input type="time" id="horaInicio" name="horaInicio" required>
                </div>

                <div class="form-group">
                    <label for="horaFin">Hora Fin:</label>
                    <input type="time" id="horaFin" name="horaFin" required>
                </div>               
            </div>

            <button type="submit" class="btn-submit">Registrar Horario</button>
        </form>
    </div>
    
<script>

    async function MostrarEspecialidad(){

      var result= await fetch("https://api-rest-ventas-production.up.railway.app/api/Especialidades")
      var especialidades=await result.json();
      var cbEspecialidades=document.getElementById("especialidad")
      cbEspecialidades.innerHTML=""
       especialidades.forEach((especialidad)=>{
                
                const optionElement = document.createElement("option"); 
                optionElement.value = especialidad.id_especialidad; 
                optionElement.textContent = especialidad.Descripcion;
                cbEspecialidades.appendChild(optionElement);
      })
    }
    async function seleccionarMedico(event){
        
        var medicos=document.getElementById("cbMedicos")
        medicos.innerHTML=""
        let  cbEspecialidades=document.getElementById("especialidad")


        var EspecialidadDescripcion=event.target.options[cbEspecialidades.selectedIndex].text
        var IdEspecialidad=parseInt(event.target.value)
        const response = await fetch(`https://api-rest-ventas-production.up.railway.app/api/MedicosEspecialidad/${IdEspecialidad}`);
        const medicosEspecialidad=await response.json();

        
         if(medicosEspecialidad.length>0) {
             medicosEspecialidad.forEach((especialidad)=>{
                
                const optionElement = document.createElement("option"); 
                optionElement.value = especialidad.id_medico; 
                optionElement.textContent = especialidad.Nombres;
                medicos.appendChild(optionElement);
            })

            }
            else {

                alert("No existe medicos para esta especialidad")
            }
            

         event.preventDefault();
    }

  async function RegistrarHorario(){

         var id_medico=document.getElementById("cbMedicos").value;
        var FechaHorario =document.getElementById("fechaAtencion").value;
        var Cupos =document.getElementById("Cupos").value;
        var HoraInicio =document.getElementById("horaInicio").value;
        var HoraFin =document.getElementById("horaFin").value;

         const Horario={
            id_medico,
            FechaHorario,
            Cupos,
            HoraInicio,
            HoraFin
         }
         
            const response = await fetch("https://api-rest-ventas-production.up.railway.app/api/Horario", {
                method: "POST",
                body: JSON.stringify(Horario),
                headers: {
                    "Content-Type": "application/json"
                }   
            });

            const result = await response.json();
            console.log(result)
            if(result.id>0){
                alert(result.mensaje)

                Limpiar();
                window.location.href="HorariosMantenimiento.html"
            }
            else {
                alert("Ingresar los datos correctamente")
            }

      
    }

    function Limpiar(){

       document.getElementById("cbMedicos").value="";
       document.getElementById("fechaAtencion").value="";
       document.getElementById("Cupos").value="";
       document.getElementById("horaInicio").value="";
       document.getElementById("horaFin").value="";
    }
    /*enviando datos en formulario*/
    document.getElementById("horarioForm").addEventListener("submit",(e)=>{
        RegistrarHorario()
        
        e.preventDefault();

    })

    MostrarEspecialidad()
</script>
</body>
</html>